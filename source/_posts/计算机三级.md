---
title: 嵌入式系统开发技术摘要
date: 2019-03-06 16:44:47
tags: 嵌入式
---
# 嵌入式系统开发技术

前言：写来给计算机三级整理用的，虽然意义不是很大。

[TOC]
---
## 第一章：嵌入式系统概论
## 1.1嵌入式系统及其应用

### 1.1.1嵌入式系统
  嵌入式计算机系统的简称，广泛应用于各个领域，它几乎无处不在。
  概念：嵌入式系统是以应用为中心，以计算机技术为基础，软硬件可裁剪，适应应用系统对功能、可靠性、成本、体积、功耗等多种约束的专用计算机系统。 

特点：
1. 专用性：  具体应用紧密结合，目标明确，很强的专用性。例如采集环境温度
2. 隐蔽性：  例如：ATM机，数码相机等
3. 资源受限：通常要求系统小型化、轻量化、低功耗、低成本等
4. 高可靠性：例如汽车、数控机床等
5. 实时性：  报警领域
6. 软件固化：程序固化在ROM中，用户不能随便修改。

应用领域:
+ 消费类：冰箱、洗衣机、空调、数码相机、游戏机等
+ 产业类：数控机床、汽车、飞机、监护仪等
+ 业务类：电话机、打印机、POS机、路由器、手机等
+ 军用类：火炮、导弹等军用电子设备

  嵌入式系统在应用数量上远远超过了各种类型的通用计算机系统。
  
### 1.1.2嵌入式系统组成及分类

逻辑组成：
**硬件：**

+ 处理器：采用微米级（深亚微米级至纳米级）半导体加工工艺。
CPU：中央处理器[4/8/16/32位字长，使用最多8/16位，32/64位是技术发展主流]
DSP：数字信号处理器
决定嵌入式系统性能的参数：**主频、指令系统、缓存、逻辑结构**
+ 存储器：     
    + 易失性存储器 RAM: DRAM存放正在运行的程序/数据，
SRAM 存储速度快，高速缓存使用
	+ 非易失性存储器 ROM：Flash ROM NOR Flash 字节为单位存储
NAND Flash 页为单位存储
+ I/O设备与I/O接口: 
	+ 人机交互：按键、LED、触摸板、
	+ 机机交互：各种传感器和伺服执行机构
	+ VGA：视频图像阵列
	+ HDMI：高清晰度多媒体接口
	+ DVI：数字视频接口
	+ CAN：控制器局域网
+ 数据总线: Data Bus，简称总线；数据线和控制电路组成

**软件：**

安卓Android为例:
+ 最底层：各种驱动程序和Linux内核
+ 第二层：系统库和Android运行环境
+ 第三层：应用软件框架
+ 第四层：应用程序
+ BSP：板级支持包

嵌入式处理芯片
特点：支持实时处理、低功耗、结构可扩展、集成测试电路

目前嵌入式处理芯片有4种产品类型：
1. 微处理器
2. 数字信号处理器DSP：哈佛结构、SIMD
3. 微控制器
4. 片上系统Soc

嵌入式系统的分类与发展

+ 用途:    军用、工业用、民用
+ 实时性:    非实时系统、软实时系统、硬实时系统
+ 产品形态:   系统级：PC104模块 板级：带CPU的主板
+ 片级：单片机、微处理器、DSP、Soc
+ 系统复杂程度:     低端系统、中端系统、高端系统
+ 发展:     1/4/8/16/32/64 位

应用系统举例:数码相机

### 1.1.3  Soc芯片

微电子技术    
+ 核心：半导体集成电路
+ 分类：小规模、中规模、大规模、超大规模、及大规模
+ 摩尔定律：单块集成电路的集成度平均每18-24个月翻一番

通用Soc和专用Soc：
+ **通用Soc芯片**：半导体企业通过自主开发处理器内核或购买其他企业的处理器内核的IP授权，按照目标应用领域功能要求所开发的SoC芯片系列。
+ **专用SoC芯片**：嵌入式系统开发商依据待开发产品的特殊要求，向半导体企业定制的SoC芯片。

Soc芯片开发流程:  主要工作是借助EDA(电子设计自动化)工具完成。
1、总体设计2、逻辑设计3、综合与仿真4、芯片制造

IP核及其复用   :   
+ IP：（Intellectual Property）知识产权
+ 分类：**固核、软核、硬核**
+ IP复用：减少研发成本、缩短研发时间、实现快速设计、尽早投放市场的有效途径。

## 1.2嵌入式系统与数字媒体

### 1.2.1数字文本(Text)

字符集及编码：   
1. 西文字符：ASCII字符集：128个字符+96个可打印字符+32个控制字符【7个2进制进行编码】
2. 汉字编码：
+ GB2312:包含汉字和拉丁字母、俄文、日文、希腊字母和汉语拼音等【十六个2进制进制标识】
+ GB18030：和国际标准的UCS/Unicode字符集基本兼容
3. UCS/Unicode：
+ UTF-8 : 采用单字节可变长编码。
+ UTF-16: 采用双字节可变长编码。

文本类型：数字文本也称电子文本或文本                
1. ：简单文本，纯文本，后缀名为.txt                
2. ：丰富文本，PDF、.doc等格式                
3. ：超文本，【超链接】

文本制作和展现: 字符的形状有两种描述方法：          
+ 点阵法，描述字符离散点阵中笔画的占位信息          
+ 轮廓法，描述字符的轮廓

### 1.2.2 数字图像
数字图像获取及主要参数

获取方法：数码相机和扫描仪       
**获取步骤：扫描-->分色-->取样-->量化**       
参数： 图像大小、位平面数目(像素颜色分量数目)、像素深度、颜色模型

常用格式及应用 
  **图像数据量(单位：字节)=图像水平分辨率×图像垂直分辨率×像素深度/8**  

常用格式：
+ BMP：Windows应用程序            
+ GIF：互联网，颜色数目不超过256色，文件小，适合互联网传输。
+ JPEG：互联网、数码相机【有损】，静止图像数据压缩编码的国际标准           
+  PNG：互联网、桌面出版            
+  TIF：桌面出版

### 1.2.3 数字音频及视频

音频视频的数字化
音频：
+ 音频频率范围：20Hz-20kHz的模拟信号。
+ 语音信号范围：300-3400Hz，电话取样频率为8kHz，音乐为全频，取样频率为40kHz。

音频数字化步骤：**取样-->量化-->编码**。      
**数字信号码率(单位：b/s)=取样频率×量化位数×声道数/压缩比**

编码类型：
+ 未压缩  ：WAV 
+ 无损压缩：FLAC、APE、M4A 
+ 有损压缩：MP3、WMA、AC3、AAC
视频：压缩编码标准：
+ MPEG-1： VCD、数码相机、数字摄像机 
+ H.261 
+ MPEG-2： 用途最广，DVD，数字卫星电视、数字有线电视 
+ MPEG-2   High Profile 
+ MPEG-4   ASP 
+ MPEG-4 AVC：最新应用最多的标准

##  1.3数字通讯与计算机网络

### 1.3.1数字通讯

模拟/数字通讯
+ 模拟信号：连续变化的物理量(如电平的幅度或电流的强度)来表示，信号容易受到干扰，传输不稳定。
+ 数字信号：用高低电平来表示电流的大小，抗干扰能力强，差错可控制。

有线/无线通讯
+ 有线通讯：传输介质通常为金属导体或者光导纤维。双绞线、同轴电缆、光缆 。
+ 无线通讯：不需要物理连接，通过电磁波在自由空间的传播来传输信息。

无线电波按照频率/波长分为**中波、短波、超短波、微波**。
+ 中波：沿地面传播，绕射能力强，适合广播和海上通讯 
+ 短波：较强的电离层反射能力，适合环球通讯。 
+ 超短波/微波：绕射能力弱，适用于视距或超视距中继通讯 
+ 微波：300MHz-300GHz，微波中继距离在50km，典型代表：手机。

>+ 第1代个人移动通讯：模拟传输技术。
>+ 第2代个人移动通讯：数字通讯，频段900MHZ-1800MHz，使用GSM和CDMA，俗称全球移动通讯系统，简称2G。
>+ 第3代个人移动通讯：使用频段1885-2025MHz，2110-2200MHz，传输速率几个Mb/s,中国移动自主研发TD-SCDMA，中国电信CDMA2000,中国联通WCDMA，不同标准的网络互通，但终端设备（手机）不兼容。
>+ 第4代个人移动通讯; 传输速率100Mb/s,中国移动TD-LTE,兼容3G(TD-SDMA)和2G(GSM)，中国联通和电信采用FDD-LTE,终端设备采用多模工作方式，兼容之前的3G和2G网络。

数字通讯传输技术
+ 调制与解调技术
+ 多路复用技术 
	+ 时分多路复用TDM
	+ 频分多路复用FDM
	+ 波分多路复用WDM
+ 交换技术  分组交换技术

### 1.3.2 计算机网络

网络组成：
+ 计算机等智能电子设备终端
+ 数据通讯链路
+ 通讯协议
+ 网络软件

网络类型：
+ 局域网LAN
+ 城域网MAN
+ 广域网WAN

以太局域网：
+ 传输方式：分组交换技术，
+ 格式为：发送设备MAC地址，接收设备MAC地址，控制信息，有效载荷，信息校验
+ MAC地址：全球唯一，48个二进制组成。

无线局域网：无线电波进行数据传输，分为2.4GHz和5.8GHz两个频段 
协议：
+ IEEE802.11，俗称WiFi.       
+ IEEE802.11b（2.4GHz频段），传输速率11Mbps        
+ IEEE802.11a（5.8GHz频段）
+ IEEE802.11g（2.4GHz频段） 传输速率54Mbps    
+ IEEE802.11n                传输速率108Mbps    
+ IEEE802.11ac               传输速率1000Mbps    
+ 无线接入点（WAP或AP）。
+ 蓝牙Bluetooth 瑞典爱立信公司提出，无线协议IEEE802.15.

### 1.3.3 互联网

IP协议和路由器
IP协议：
+ IPv4协议中，每个IP地址使用32个二进制表示。 
+ IPv6协议中，每个IP地址使用128个二进制表示。
+ IP协议分为A,B,C三个基本类 

IP数据报：头部和数据区。
路由器：选择路由和转发IP数据报。

互联网及其组成
互联网的接入: 
1. ADSL接入 
2. 有线电视网接入 
3. 光纤接入网 
4. 无线接入：无线局域网接入、GPRS移动电话网接入、3G移动电话网接入、4G移动电话网接入

##  第二章：嵌入式处理器

## 2.1处理器概述

### 2.1.1嵌入式处理器结构类型

指令集：
+ 复杂指令集结构**CISC**(Complex Instruction Set Computer)
+ 精简指令集结构**RISC**(Reduced Instruction Set Computer)

存储机制：
+ 冯·诺依曼von Neumann：数据和程序代码存放在一起
+ 哈佛结构Harvard：数据和程序代码分开存储

字长：8位、16位、32位、64位

内核系列：51、AVR、PIC、MSP430、MIPS、PowerPC、MC68K、ColdFire、ARM

### 2.1.2嵌入式处理器简介

  51、AVR、PIC、MPS430、MIPS、PowerPC、MC68K、ColdFire、ARM等内核

### 2.1.3 ARM处理器概述

ARM处理器特点
1. 单周期操作
2. 只使用加载/存储指令访问内存
3. 指令长度固定
4. 三地址指令格式
5. 指令流水线技术
6. 低功耗设计

ARM处理器架构发展
+ ARMv1  1985    
+ ARMv2  1987    
+ ARMv3  1992 
+ ARMv4/ARMv4T  1996    S3C2410 
+ ARMv5  1999    ARMv5TE  1999    ARMv5TEJ  1999 
+ ARMv6  2001 ARMv7M  2004 ARMv6M  2004 
+ ARMv7R  2004    Coetex-R4/R5/R7 
+ ARMv7A  2004    Coetex-A5/A7/A8/    A9/A15/A17 
+ ARMv8A  2011    Coetex-A53/A57

ARM指令集比较
+ Thumb-2指令集：混合指令集，既有16位指令也有32位指令
+ Thumb指令集：全部为16位指令
+ ARM指令集：全部为32位指令

## 2.2 ARM典型处理器介绍

经典ARM处理器：ARM7、ARM9、ARM11(ARMv4T、ARMv5TE、ARMv6架构)

ARM Cortex嵌入处理器：**ARM Cortex-M**系列Cortex-M0/M0+/M1/M3/M4，**成本和功耗敏感低端处理器**

ARM Cortex**实时**处理器：**ARM Cortex-R**系列包括Cortex-R4/R5/R7,**中档处理器**

ARM Cortex**应用**处理器：**ARM Cortex-A**系列包括Cortex-A17/A15/A12/A9/A8/A7/A5，**高端处理器**

ARM专家处理器：SC100、SC300

## 2.3 ARM处理器体系结构

### 2.3.1 ARM处理器工作状态和模式

工作状态：ARM和Thumb之间的切换 :
指令BX    
+ ARM到Thumb：R[0]=1;    BX R0             
+ Thumb到ARM：R[0]=0;    BX R0
1. ARM状态：          ARM处理器复位后总是处于ARM状态
2. Thumb/Thumb-2状态：（Cortex-M处理器只有Thumb-2状态和调试状态）
3. 调试状态

工作模式CPSR:[M4:M0]（Cortex除外）
+ **用户模式User [10000]**
+ **快速中断模式FIQ [10001]**
+ **外部中断模式IRQ [10010]**
+ **管理模式SVC [10011]**
+ **中止模式ABT [10111]**
+ **系统模式SYS [11111]**
+ **未定义指令模式UND [11011]**

### 2.3.2 ARM处理器的寄存器组织

ARM状态下寄存器组织
+ ARM处理器共37个寄存器：31个通用寄存器和6个状态寄存器
+ R15：  程序计数器（PC） 
+ **CPSR**： 当前程序状态寄存器 
+ R7~R0：通用寄存器

状态寄存器：当前程序状态寄存器CPSR和备份程序状态寄存器SPSR 
+ N：符号标志，N=1运算结果为负数 
+ Z：全0标志，Z=1运算结果为0 
+ C：进位、借位标志，C=1，加法有进位，减法无借位 
+ V：溢出标志，V=1,加减法运算结果有溢出 
+ Q：增强的DSP运算指令溢出标志，Q=1，有溢出 
+ I：外部中断控制位，I=1，禁止外部IRQ中断 
+ F：快速中断控制位，F=1，禁止FIQ中断 
+ T：ARM与Thumb指令切换，T=1，Thumb指令 
+ M4~M0：模式选择位
  

CPSR状态寄存器分为4个域：标志域F(31:24)、状态域S(23:16)、扩展域X(15:8)、控制域(7:0)，单个字节可以单独操作域而不影响其他位。

Thumb状态下寄存器组织：在Thumb状态下R8-R12下不可见
带MMU的ARM处理器中的控制寄存器（略过）

### 2.3.3 ARM处理器的异常

ARM异常种类、异常向量表和优先级   
异常类型|优先级|工作模式 
:-------------:|:--------:|:---------:
复位RESET |1 | 管理模式 
未定义UND| 6|中止模式 
软件中断SWI|6|管理模式 
指令预取中止PABT|5|中止模式 
数据访问中止DABT|2 |中止模式 
外部中断请求IRQ|4|外部中断模式 
快速中断请求FIQ|3|快速中断模式

异常中断响应过程
异常处理程序返回

### 2.3.4 存储器格式和数据类型

存储字格式：**大端模式**
32位数据字的高字节存储在低地址中，而数据字的低字节存放在高地址中。
例如：0x12345678存放的起始地址为0x30001000， 
大端模式下，
>0x30001000单元存放0x12；            
0x30001001单元存放0x34；             
0x30001002单元存放0x56；
0x30001003单元存放0x78；

**小端模式**
32位数据字的高字节存储在高地址中，而数据字的低字节存放在低地址中。
例如：0x12345678存放的起始地址为0x30001000， 
小端模式下，
>0x30001000单元存放0x78；             
0x30001001单元存放0x56；             
0x30001002单元存放0x34；            
0x30001003单元存放0x12；

**与大端模式存放数据完全不同。系统复位时一般自动默认为小端模式**。

数据类型：32位ARM处理器支持字节（8位）、半字（16位）、字（32位）3种数据类型。字需要4字节对齐，半字需要2字节对齐。 
ARM指令固定长度32位指令，**且字对齐**。 
Thumb指令长度16位指令，且2**字节字对齐**。

### 2.3.5 MMU和MPU

MMU虚拟存储器技术：通过地址映射，使需要运行在连续地址空间的软件可以运行在不连续的物理存储空间，需要较大存储空间的软件可以运行在较小容量的物理存储器中。

MMU：存储器管理单元，高性能处理器所必须的重要部件之一
MMU的功能：①虚拟地址到物理地址映射、②存储器访问权限控制。
MPU：存储器保护单元

## 2.4 ARM处理器指令集

### 2.4.1 ARM指令分类和格式

ARM指令分类：
1. 分支指令 
2. 数据处理指令 
3. 程序状态寄存器处理指令 
4. 加载/存储指令 
5. 协处理器指令 
6. 异常指令

ARM指令格式
ARM状态下寄存器组织

\<opcode> {\<cond>} {S}   \<Rd> , \<Rn> {,\<op2>}    

\<>不可省略    
{}可省略
\<opcode>		指令操作码		[31:28] 
{cond}			条件域			    【可省略】		 
{S}	    	指令执行是否更新CPSR	【可省略】  
Rd				目的寄存器  
Rn				第一个源操作数 
op2				第二个源操作数 
opcode，cond与S之间没有分隔符 
{S}和Rd之间用空格隔开。

imm8m：
+ ARM指令集：imm8m表示一个由8位立即数经循环右移任意偶数位次形成的32位操作数
+ Thumb指令集：imm8m表示一个由8位立即数经左移任意位次形成的32位操作数

ARM指令中操作数符号
1. ‘#’--立即数符号，后面是十进制或十六进制数 
2. ‘0x’--十六进制符号，后面的数据表示十六进制 
3. ‘！’--更新基址寄存器符号，表示指令完成操作后最后的地址应该写入的基址寄存器 
4. ‘^’--复制SPSR到CPSR符号 
5. ’-‘--寄存器列表范围 R7-R0；

移位操作符
1. 逻辑左移    LSL 
2. 算数左移    ASL 
3. 逻辑右移    LSR 
4. 算数右移    ASR 
5. 循环右移    ROR 
6. 带扩展的循环右移  RRX

### 2.4.2 ARM指令寻址方式：
+ 立即寻址
+ 寄存器寻址
+ 寄存器间接寻址
+ 变址寻址
+ 相对寻址
+ 堆栈寻址
+ 块拷贝寻址

ARM指令集
Thumb指令集
ARM处理器伪指令

### 2.5 ARM汇编语言程序设计

ARM汇编器支持的伪指令
ARM汇编语言语句格式
汇编语言程序设计举例
C语言汇编语言混合编程

## 第三章：嵌入式系统硬件组成

## 3.1 硬件组成概述

嵌入式系统由嵌入式硬件系统和嵌入式软件系统组成。 
+ 嵌入式硬件系统由嵌入式处理器、存储器、I/O接口等构件。 
+ 嵌入式硬件系统可分为：嵌入式最小系统和典型嵌入式硬件系统、

最小硬件系统：
+ 电源电路：
	+ 交流变直流模块（AC-DC）
	+ 直流到直流模块（DC-DC）
	+ 低压差稳压器LDO（Low Dropout Regulator）
+ 时钟电路：
	+ 为嵌入式处理器提供时钟信号 
	+ 晶振：有源晶振和无源晶振
+ 复位电路：
	+ 嵌入式处理器有一个系统复位引脚nRESET或RESET，n表示低电平复位。 ARM复位后PC指针指向唯一的地址0x00000000，此处通常有一条无条件转移指令B RESET，转向RESET开始系统的初始化程序。
+ JTAG测试接口：内部测试电路 JTAG(Joint Test Action Group)是一种国际标准测试协议。 
SWD是Cortex-M内核提供的另外一种少引脚调试接口，串行线调试接口：SWD和SWCLK两根信号线；调试时也需要加上地线和复位信号线。

ARM内核典型嵌入式应用系统硬件组成

典型的嵌入式应用系统硬件由以下几部分组成： 
1. 嵌入式最小硬件系统： 
2. 前向通道：即**输入接口**，由模拟量输入接口（传感器、信号调整电路，
A/D转换器等）和数字量输入接口组成 
3. 后向通道：即**输出接口**，由模拟输出接口（D/A转换器、功率放大器和
执行器等）和数字输出接口组成。 
4. 人机交互通道：键盘、触摸屏输入接口以及LED或LCD输出显示接口 
5. 相互互连通讯通道：RS-232/RS-485串行通信接口，CAN通信接口，以太
网通信接口、USB通信接口

## 3.2 嵌入式处理芯片

### 3.2.1 AMBA总线体系结构及标准

AMBA(Advanced Microcontroller Bus Architecture)：先进微控制器总线体系结构。 
1. ARM公司公布的总线协议，用于连接和管理偏上系统中功能模块的开放标准和片上互联规范。 
2. **AMBA**总线1995年推出AMBA1.0到2011年AMBA4.0共计4个版本，总线性能不断提升。 
3. **ASB****(Advanced System Bus)先进系统总线** 
**AHB**(Advanced Hign-performance Bus)**先进高性能总线**（ASB发展而来）主要用于连接高宽带快速组件。 
4. **APB(Advanced Peripheral Bus)先进外围总线**，主要连接低带宽组件与外部相连的硬件组件。 **系统组件通过桥接器（Bridge）与外围总线互联**。

### 3.2.2 ARM内核嵌入式芯片的硬件组成

**AHB连接的高带宽组件包括**：电源管理和时钟管理器、测试接口JTAG、外部存储器控制器接口、DMA控制器、USB主机、片上SRAM及FLASH、Etherent、高速GPIO中断控制器、LCD控制器等。
**APB连接的低速带宽组件包括**：GPIO、UART、SPI、I2C、USB设备、CAN、ADC、DAC、WDT、Timer、RTC、PWM等。

+ 存储器与控制器：片内程序存储器通常是Flash ROM； 片内数据存储器通常是SRAM；
+ 中断控制器： VIC：中断向量 NVIC：嵌套向量中断 处理中断两种形式：标准的中断控制器和向量中断控制器（VIC）
+ DMA控制器：（Direct Memory Access）：直接存储器访问控制器 使用它可以将数据块从外设传输至内存、从内存传输至外设或从内存传输至内存。 数据的传输过程中不需要CPU的参与，可以显著降低处理器的负荷，提高数据处理的效率。
+ 电源管理与时钟管理器：ARM处理器内部电源管理主要有：**正常工作模式、慢时钟模式、空闲模式、掉电模式、休眠模式、深度休眠模式**等。 时钟控制器负责对时钟的分配，产生不同频率的定时时钟可供片内个组件作为同步时钟使用。
+ GPIO端口： (General Purpose Input Output)即通用输入/输出端口。 作为**输入具有缓冲**功能，而作为**输出时则具有锁存**功能。 有的引脚是双功能，也有三功能甚至四功能的引脚。
+ 定时计数组件：包括：①WDT（Watchdog Timer）：看门狗定时器 ②Timer通用定时器，用于一般的定时 ③RTC：提供年月日时分秒 ④脉冲宽度调制器PWM（Pulse Width Modulation）：用于电机等控制
+ 模拟通道组件：内部的模拟组件包括ADC和DAC： 
	+ ADC：模拟到数字的转换器，可完成从模拟信号到数字信号的变换。它是一个模拟输入的组件。
	+  DAC：数字到模拟的变换器，可完成从数字信号到模拟信号的变换，一般在后级还需要加功率放大才能接到实际应用系统中。
+ 互联通信组件：
	1. UART通用异步收发器（Universal Asynchronous Receiver/Transmitter)：标准的串行通信接口。字符格式按照地位在前、高位在后，1位起始位、5-8位数据位、1位奇偶校验位，1-2位停止位。 
	2. I2C（Inter－Integrated Circuit）集成电路互联的一种总线标准。两根信号线，时钟线（SCL）和数据线（SDA） 
	3. I2S（Inter－Integrated Circuit Sound Bus）多媒体应用的音频串行总线 
	4. SPI（Serial Peripheral Interface）是串行外设接口，它是一种同步串行外设接口，通常用四线制，包括MISO（主输入从输出）、MOSI（主输出从输入）、SSL（芯片选择）、SCK（时钟） 
	5. CAN(Controller Area Network)控制器局域网，仅有CANH和CANL两根信号线，采用差分传输方式，远距离1200m，抗干扰能力强，可组成多主多从系统。 
	6. USB（Universal Serial Bus）通用串行总线，主要应用于与外部设备的短距离通信，采用查分信号传输数据，速度快，效率高。 
	7. Ethernet是以太网通讯接口。

### 3.2.3 常用ARM嵌入式处理芯片

+ NXP的ARM芯片
+ TI的ARM芯片
+ Samsung的ARM芯片（基于ARM920T内核的S3C4xx系列）
+ Atmel的ARM芯片
+ ST的ARM芯片
+ Freescale的ARM芯片
+ Nuvoton的ARM芯片
+ Intel的ARM芯片
+ 其他ARM芯片厂家

### 3.2.4  嵌入式处理芯片的选型

性价比原则：完全能够满足要求且略有余量的嵌入式处理器芯片
参数选择原则

## 3.3 嵌入式系统存储器

### 3.3.1 层次结构：
缓存（Cache）技术，目前嵌入式系统采用SRAM作为Cache，分为一级Cache(L1)h和二级Cache(L2)

### 3.3.2 分类：半导体存储器：
RAM：
+ SRAM:静态随机存取存储器（嵌入式内嵌的数据存储器）
+ DRAM:动态随机存取存储器（外部扩展的存储器）
ROM：
+ MROM:掩膜型只读存储器
+ PROM:一次可编程只读存储器
+ EPROM:紫外线可擦除可编程只读存储器
+ E2PROM:电可擦除可编程只读存储器
+ Flash:闪速存储器
	+ **NOR Flash ROM**：以页（行）为单位随机存取，数据存储器使用
	+ **NAND Flash ROM**：以字节为单位随机存取

新型存储器:
+ **FRAM:铁电**随机存取存储器
+ **MRAM:磁性**随机存取存储器

### 3.3.3性能指标
容量:
存储器容量是指每一个存储芯片或模块能够存储的二进制位数。 存储1位二进制位为最小单位（b）。 
容量单位有字节（Byte，B）、千字节（Kilo-Byte，KB）、兆字节（Mega-Byte，MB）、吉字节（Giga-Byte，GB）、太字节（Tera-Byte，TB）。 
**对内存而言**：容量单位之间的相互关系为**2^10=1024倍**表示； 
**对外存容量**：容量单位之间的相互关系为**10^3=1000倍**表示； 

存储器容量计算公式：
>V=2^m×n                 
V：存储器容量                 
m：地址线条数                 
n：数据线条数

存取时间：从CPU给出有效的存储器地址开始到存储器读出数据（或者把数据写入存储器）所需要的时间。 
>1s=10^3ms=1000ms 
1ms=10^3μs=1000μs 
1μs=10^3ns=1000ns

带宽:存储器带宽是指：每秒可以传输（读出/写入）的最大数据总量。单位：B/s、KB/s、MB/s、GB/s、 
传输带宽与存储器**总线的频率、数据位数（宽度）、总线周期的传输次数有关**。 
并行总线存储器带宽：
>**带宽=总线频率×数据宽度/8×传输次数/总线周期 （B/s）**

例如：存储器频率333MHz，数据宽度32位，每周期传输1次，
则带宽为：333×32/8×1 B/s =1332MB/s 
并行总线存储器带宽：
>带宽=总线频率×（1/10）（B/s）

### 3.3.4 片内存储器

+ 片内Cache： 容量几KB、几百KB或几MB，有一级Cache、二级Cache
+ 片内Flash ROM：程序存储器
+ 片内SRAM：  数据存储器（系统复位要对SRAM初始化）
+ 片内E2PROM：做长期保存重要的数据
+ 片内FRAM：  具有ROM和RAM的优点，因此既可以做ROM也可做RAM

### 3.3.5 片外存储器

片外程序存储器:  
1. NOR Flash(参见P130的表3-4) 
2. NAND Flash
重要的几个引脚说明：        
+ BYTE#：8位（0）/16位选择（1）        
+   CE#：芯片使能          
+   OE#：数据输出使能         
+    WE#：写使能       
+    RESET#：硬件复位       
+    RY/BY#：准备就绪/忙输入 
+    引脚低电平有效的几种表示方式：(prague.jing)        
+    带#号：OE#     
+    带上划线：       
+    带n号：nRESET
+    片外数据存储器：SDRAM\DDR/DDR2/DDR3/DDR4

### 3.3.6外部辅助存储设备

+ SM卡：被SD卡和MMC卡取代
+ CF卡：采用NAND Flash ROM作为存储器
+ MMC卡：应用于数码影像、音乐、手机、PAD等
+ SD卡：mimiSD卡和microSD卡（TF卡）
+ 记忆棒
+ XD卡
+ U盘：全称为USB闪存盘，USB flash disk
+ 微硬盘

## 3.4  I/O接口和I/O设备
+ 通用I/O接口GPIO：
	+ 通用输入输出接口：输入时具备缓冲功能，而输出时具有锁存功能。 
	+ GPIO一般有三种状态：**0态、1态和高阻状态**。
+ 集成电路互联总线接口I2C：用于连接嵌入式处理器及外围器件广泛采用的**一种串行半双工**传输总线标准。
	+  通讯速率：400kb/s、3.4Mb/s（高速模式） 
	+  只有两条线：**数据线SDA和时钟线SCL**。数据线SDA上的数据必须在时钟的高电平期间保持稳定，它的高/低电平状态只有在SCL时钟信号线是低电平时才能改变。 
	1. 起始和停止条件：     
		+ 起始：**SCL保持高电平时SDA线由高电平转为低电平**，此时主控器件在SCL产生时钟信号，SDA线开始数据传送。     
		+ 停止：**SCL为高电平时SDA电平由低转为高**，则总线停止工作，恢复为空闲状态。 
	2. 数据传送格式：数据传送时高位在前，低位在后，每次传送的字节数目没有限制。传送操作启动后主控器件传送的第一个字节为地址，其中前7位指出与哪一个从器件进行通讯，第8位指出数据传送的方向（发送还是接收）。 
	3. 应答信号：完成一字节的传送，接受方应该发送一个确认信号ACK给发送方。ACK信号在SCL的第9个时钟上，有效的应答ACK在SDA上呈现低电平。 
	4. 读/写操作：     
		+ 发送：数据被发送出去后，I2C接口将处于等待状态（SCL线将保持低电平），直到有新的数据写入I2C数据发送寄存器后，SCL线才被释放，继续发送数据。   
		+ 接收：I2C接口接收到数据后，将处于等待状态，直到数据接收寄存器内容被读取后，SCL线才被释放，继续传输数据。 
	5. 总线仲裁：**I2C总线属于多主总线**，允许总线上有一个或多个主控制器和若干从器件同时进行操作。 仲裁机制为线与机制，即总线控制器遵循“SDA线低电平优先”的原则。 
	6. P139 图3-16/17
+ 串行外设接口SPI：   
	+  SPI是一种**同步串行外设接口**，数据传输格式为高位在前，低位在后。
	+  SCK：时钟信号线 
	+  SSEL：设备使能线
	+  MOSI：主设备输出从设备输入 
	+  MISO：主设备输入从设备输出 
	+  可以实现**一主一从、互为主从、一主多从、多主多从**等连接。
+ 串行异步通讯接口UART：通用异步收发传输器，通常称作UART，是一种全双工异步
收发传输器。 
	+ UART由**发送器、接收器、控制单元、波特率发生器**等构成。 
	+ UART字符格式约定： 
	1.字符总是以起始位为开始，以停止位为结束 
	2.数据以低位在前，高位在后按次序传输 
	3.数据位可以是5、6、7、8，由编程决定 
	4.数据位之后是校验位，可以是奇校验或偶校验，也可以没有校验 
	5.起始位以逻辑0为标志，停止位以逻辑1为标志，停止位可以为1、1.5、2位 
	6.通常情况接收采用中断方式，**发送采用查询**方式。 
	7.UART通讯仅限于板间或芯片间通讯，连接方式仅需三根线，**TXD、RXD及GND**。
+ 通用串行总线USB：  
	+ USB是通用串行总线（Universal Serial Bus）的首字母缩写 USB（1.1和2.0）有4根信号线：Vbus，D+、D-、GND。D+、D-为差分信号线。 
	+ 采用差分方式进行通讯 
	+ USB 2.0速度480Mb/s，USB 3.0速度5Gb/s，即640MB/s USB电源5V/500mA，USB 3.0提供5V/900mA; 
	+ 编码方式：翻转不归零制NRZI
+ 高清多媒体接口HDMI：
	+ HDMI是（High Definition Multimedia Interface）的缩写，意思是高清晰度多媒体接口，是一种数字化视频/音频接口技术，适合影像传输的专用型数字化接口，可同时传送音频和影像信号，即插即用。 
	+ HDMI有两种接口形式：**19针的Type-A和29针的Type-B**。 DVI是24针的接口，有多种规格，
	1. DVI-A：仅用于传输模拟信号，和D-SUB一样；
	2. DVI-D：仅用于传输数字信号；
	3. DVI-I：模拟信号和数字信号都可传输，专为LCD显示器和投影仪等数字显示设备设计的。 
	+ **相比DVI，HDMI接口体积小，传输距离可达15m，DVI传输距离不能超过8m**。 
+ 常用简单输入设备：
	+ 键盘  分为两种：1. 线性键盘，2. 矩阵键盘 键盘消抖时间一般为5-30ms
	+ 触摸屏  电阻式触摸屏（软屏）：利用压力感应进行控制。
	+ 电容式触摸屏（硬屏）
+ 常用简单输出设备：
	+ LED二极管和数码管
	+ LED发光二极管：常亮、长灭、闪亮（快闪、慢闪） 普通发光二极管电流5-20mA，电压1.2V左右。电流大，亮度高，寿命短。
	+ LED数码管：有八段，a，b，c，d，e，f，g，dp。可以表示数字0-9，字母A-F； 
	 分为共阳数码管和共阴数码管。
	+ LCD显示设备：较好的人机交互体验

## 3.5 典型处理器芯片[S3C2410/S3C2440]

芯片内部结构: 
+ S3C2410/S3C2440是三星公司基于ARM920T核的嵌入式处理器芯片。
采用哈弗体系结构，内部有MMU，具有16KB大小的指令Cache和16KB大小的数据Cache。
+ S3C2440在S3C2410的基础上增加了视频和音频接口。

存储器控制组件:包括：**存储器控制器、总线控制器、外部主控制器、NAND Flash 控制器**等。
时钟和电源管理组件
S3C2410内部有时钟振荡电路。
电源管理模块：
1. 正常模式       
2. 慢速模式：不使用PLL时钟，       
3. 休眠模式：不使用内核时钟FCLK，外围时钟运行，       
4. 掉电模式：断开内部电源，不产生功耗。
+  任何情况复位后均自动进入正常模式，掉电模式和休眠模式下，
+  任何外部中断均将返回正常模式。

中断控制器及中断控制: 中断控制器 P156 表3-11 
除屏蔽寄存器初始值为1外，其他寄存器的初始值均为0。

脉宽调制定时计数器PWM Timer
定时器的输入**时钟频率=PCLK/（预分频值+1）×时钟因子** 

实时时钟RTC：实时时钟（Real-Time Clock，RTC）可以提供日历/时钟的内置硬件。
需要单独的供电引脚和单独的时钟源，采用**32,768kHz**晶体。

通用I/O接口GPIO：参考各个端口的寄存器

串行异步通讯接口UART：
+ 嵌入式系统使用串行异步通讯接口需要通讯双方波特率和传输格式一致。 
+ 线路控制寄存器（奇偶校验、停止位、数据位）
+  UART控制寄存器 
+  状态寄存器 
+  数据寄存器 
+  波特率除数寄存器： 
+  UBRDIVn=INT（UCLK/（波特率×16））-1（例3-7）

I2C总线接口： 两种不同的地址形式：7位地址和10位地址。

看门狗定时器WDT：为了系统可靠的运行。一旦由于某种原因程序跑飞而死机，看门狗可以强行使系统重新复位。（例3-9）

模数转换器ADC：对模拟信号的采集

## 3.6 嵌入式系统外部通讯接口

### 3.6.1 基于UART的RS-232/RS-485

1. RS-232接口：
	+ DB9是标准的RS-232连接器。DB9-2为发送引脚，DB9-3为接收引脚，DB9-5为公共地。传输距离大约15m左右。 
	+ RS-232采用负逻辑传输：逻辑0：+3V~+15V，逻辑1：-15V~ -3V， 
	+ RS-232互联时需要交叉连接，即RXD连接到TXD，公共地互联。
2. RS-485接口：
	+ 工业控制领域、传输距离远、采用**差分信号**传输方式，抗共模干扰能力。传输距离可达1200m。
	+  RS-485逻辑电平：当A的电位比B高200mV以上时为逻辑1，反之为逻辑0。
	+  RS-485互联时同名端相连，A连A，B连B。

### 3.6.2 CAN总线接口

CAN总线采用差分方式传输。
数据帧7部分组成：**帧起始、仲裁域、控制域、数据域、CRC域、应答域、帧结尾**。
CAN互联时采用**同名端**相连，CANL连CANL，CANH连CANH。

### 3.6.3 以太网通讯接口

### 3.6.4 常用无线通讯接口
1. PS模块：全球定位系统（Global Positioning System），简称GPS。民用精度100m，采用差分GPS技术后，精度5m。
2. 北斗模块：北斗一代称为北斗导航实验系统（BDTS），北斗二代称为北斗卫星导航系统，是继美国GPS和俄国GLONASS之后第三个成熟的卫星导航系统。定位精度10m，授时精度50ns，测速精度0.2m/s。
3. GPRS模块：GPRS是通用分组无线服务的简称，是GSM移动电话用户可用的一种移动数据业务。
4. WIFI模块：**802.11**协议的无线局域网，无线WIFI模块内置TCP/IP协议栈，可以使有线数据到无线数据的传输。
5. 蓝牙模块：短距离通讯（10m之内）的无线低速（1Mb/s）通讯技术。
6. 其他（Zigbee、LoRa、433）

## 第四章：嵌入式系统软件

## 4.1 嵌入式软件的组成
+ 嵌入式软件的特点：
	+ 软硬件一体化，软件固化存储
	+ 代码效率高、实时性要求高
	+ 软件可裁剪
	+ 安全性、可靠性要求高(容错设计)
	+ 软件开发难度大(软硬件、开发环境、调试技巧掌握)
	+ 面向客户、面向应用
	+ 软件产业高度分散(嵌入式针对性很强)
	+ 生命周期长(跟新替换同产品同步进行)
+ 嵌入式软件的结构：
	+ **轮询结构**(没有中断)
	+ 带中断的轮询结构
	+ 监控式操作系统(µC/OS(内核+任务调度+任务通讯+中断管理))+应用软件
	+ 嵌入式操作系统(Android)+应用软件
+ 硬件抽象层HAL与板级支持包BSP
	+ 概念：
		+ **硬件抽象层：Hardware Abstract Layer** 
		操作系统层和硬件之间设置的独立接口软件层，是所有直接依赖于硬件的软件，包括引导程序、硬件配置程序、硬件访问代码。
		+ **板级支持包：Board Support Package**
由硬件制造商专门编写，屏蔽了其所支持的嵌入式操作系统和底层硬件平台的相关性。
	+ 实例：
		+ 开发和移植：最小系统调试。外围设备驱动程序调试
+ 引导加载程序Bootloader
	+ 概念和功能：嵌入式系统上电复位后首先运行引导加载程序，它负责系统的上电自检、硬件初始化、建立存储空间映射、配置系统参数、建立上层软件的运行环境、并加载和启动操作系统。
	+ 嵌入式操作系统的加载方式：
		+ ROM中直接运行操作系统
		+ RAM中运行操作系统
		+ 外部存储器加载操作系统
		+ 通讯接口加载操作系统
+ 引导加载程序的执行过程

  + U-Boot：最强、最具弹性、应用最广、更新最快的开源BootLoader
+ 设备驱动程序：  
	+ 以24C02为例：
		1. 只能被高层软件调用而无法自行运行；
		2. 对上层软件屏蔽硬件细节，对下层硬件直接进行操作。

## 4.2 嵌入式操作系统

实时系统与实时操作系统
+ 实时系统：必须在有限和确定的时间内对外部事件作出响应的信息系统。 IEEE计算机协会实时系统技术委员会(IEEE-CT-TCRTS)：正确性不仅取决于计算的结果，而且取决于产生结果的时间的计算机系统。 
实时系统对外界的响应是否正确不仅取决于功能正确性，而且取决于对事件处理的正确性。 
实时系统中的任务分为三类： 
1. **硬实时任务**：也叫做强实时任务，任务必须在给定的时限内完成，超过时限将会导致任务失败或引起致命错误。工业控制和军工系统 
2. **软实时任务**：也叫做弱实时任务，软实时任务仍然要求系统的响应越快越好，但偶尔超出时限并不会造成任务失败或出现致命错误。DVD播放机 
3. **准实时任务**：通常允许偶尔错过最后期限，但若超过时限，所进行的操作或计算结果没有任何意义。 注意：硬实时、软实时与准实时的概念与时限的长短没有关系，而与其对超过实现的容忍程度有关。 
实时系统特征：**1. 时间约束性、2. 可预测性、3. 可靠性、4. 交互性**
+ 实时操作系统：实时操作系统是不以在给定时间内完成更多的任务为目标，而是以响应外部事件尽可能快且响应时间具有确定性为目标的操作系统。
实时系统最关键的特性就是完成每次任务所需要的时间的一致性。如果一个实时操作系统能够完全满足确定性的时限要求，则称为硬实时操作系统，否则称为软实时操作系统。 
实时操作系统完成每次任务所需时间的偏差称为抖动。**硬实时操作系统的抖动比软实时系统小**。
+ 实时操作系统实时性指标：响应时间：系统从事件请求开始到任务完成的时间间隔。
	1. **中断延时时间**：接收到可屏蔽中断请求信号到操作系统做出响应并转入中断服务程序所需要的最长时间。 
	2. **任务切换时间**：操作系统在两个独立且具有相同优先级的就绪态任务之间切换所需要的时间 
	3. **任务抢占时间**：系统将控制权从低优先级任务转移到高优先级任务所花费的时间

嵌入式操作系统概述
+ 特点：具有**任务调度、同步机制、内存管理、中断处理、文件处理、** 
    1. 代码固化存储，时空效率高 
    2. 可裁剪性 
    3. 实时性 
    4. 强稳定性，弱交互性 
    5. 硬件适应性
+ 分类：
	1. 实时性：硬实时操作系统，弱实时操作系统(非实时操作系统) 
	2. 开发方式：专用嵌入式环境开发的嵌入式操作系统，通用计算机操作系统移植的嵌入式操作系统 
	3. 商业模式：免费嵌入式操作系统（RTEMS、eCOS\FreeRTOS）、商业嵌入式操作系统（VxWorks、µC/OS）
+ 内核结构：
**单内核(宏内核)**：操作系统把内核的各个功能模块（如进程管理、文件系统、设备管理、网络通信等）整合在一起，模块间的交互通过直接调用其他模块中的函数来实现，执行效率高，性能好。 
例如：**Unix，BSD Unix，Linux，MS-DOS、Windows 9x（Windows 95/98/Me），Windows CE，Android**
**微内核**：仅将必须的基本功能（任务调度、任务键通讯、存储管理、中断处理）放入内核，运行在核心态；其他功能都在内核之外，由用户态服务来完成。 
例如：**AIX、Mach（早起Apple计算机操作系统内核）、Minix、VxWorks、QNX** 
通用计算机采用微内核：**Windows NT/XP/2000、Vista，Windows 7，MacOS X，ReactOS**
+ 常用嵌入式操作系统：
	+ VxWorks：美国风河公司（09年成为英特尔的全资子公司），广泛应用于军用产品。收费
	+ QNX：QNX软件公司（10年被黑莓收购），类Unix操作系统，
	+ Nucleus PLUS：ATI公司的，代码使用ANSI C编写的
+ 嵌入式Windows操作系统家族：
	+ 嵌入式操作系统EOS：Windows Embedded Compact(WEC)
Windows Embedded 系列
	+设备平台（device platform）
		+ RTEMS：美国军方研制，用于国防系统，
		+ TinyOS：无线传感器网络操作系统，美国加州大学伯克利分校研发，开源嵌入式操作系统
		+ eCOS：嵌入式可配置操作系统，开源免费
		+ FreeRTOS：开源免费操作系统
+ Linux内核
	+ Unix：诞生于美国电话电报公司（AT&T）的贝尔实验室 Linux：属于类Unix，起源于芬兰赫尔辛基大学的学生: 林纳斯 托瓦斯。
	+ Linux是一种自由软件（开源、免费、自由定制、自由传播）。 
	+ 中国天河一号巨型机系统内核为Linux。

嵌入式Linux操作系统
+ 结构与组成：
	+ 结构：单内核。
	+ 组成：①初始化组件、②进程调度器、③内存管理、④虚拟文件系统、⑤网络接口、⑥进程间通讯、⑦可加载模块、⑧设备驱动程序
+ 实时化技术：
	1. 内核补丁方式
	2. 双内核方式
	3. 超微内核方式
+ 系统的构建：
	+ 基于通用Linux内核构建嵌入式Linux
	+ 基于嵌入式Linux发行版构建嵌入式Linux
µclinux
Monta Vista Linux
RTLinux
RTAI
Xenomai
Wind River Linux

Android操作系统
+ 系统特点：美国Google公司主导的一个开源项目。中文名字“安卓”， Android核心是以Linux内核为基础的开源操作系统。 主要应用于智能手机、平板电脑、车载导航、医疗仪器和智能家居等领域。
+ 系统组成与结构：Android采用**堆层式软件架构**，
**分为四层**：
	1. Linux内核层
	2. 系统运行库：
①Android运行环境：Dalvil虚拟机和核心库
②组件库：系统C库，媒体框架、surface manager 显示
管理库、SGL库、freetype库、SQLite库、WebKit库、
OpenGL|ES 3D库、OpenSSL库
	3. 应用程序框架：活动管理器、窗口管理器、内容提供器、视觉系统、通告管理器、包管理器、电话管理器、资源管理器、位置管理器、XMPP服务。 
	4. 应用程序：
+ 应用开发：配置开发环境
创建Android应用开发工程
运行应用程序

iOS操作系统
+ 概述：苹果公司开发的操作系统，原名为iPhone OS，应用于iphone智能手机、平板电脑、和电视机顶盒。 
**iOS同样属于类Unix的操作系统**，
+ 组成与结构：
	+ 核心操作系统层
	+ 核心服务层
	+ 媒体层
	+ 触控界面层
+ 应用开发：Xcode

## 4.3 µC/OS嵌入式操作系统

µC/OS操作系统概述：
+ 历史和发展：µC/OS是由美国Micriµm公司创始人拉伯罗斯（Jean J. Labrosse）开发的RTOS内核。 
第一个版本：µC/OS，1992年 
第二个版本：µC/OS II，1998年 
第三个版本：µC/OS III，2010年
+ 特点：
	1. 公开源码的高质量实时内核：不免费，商业用途需要获得Micriµm公司许可。 
	2. 可移植： 
	3. 可剪裁、可固化 
	4. 时间确定性 
	5. 多任务：µC/OS II可以管理**64个任务，8个保留给系统**，且不支持时间片轮转调度。 
	6. 抢占式内核 
	7. 多种系统服务：任务管理、时间管理、信号量、事件标志组、互斥信号量、消息队列、内存分区管理。
+ 组成和源代码结构：**µC/OS-II内核负责管理用户任务**，并为任务提供资源共享等服务机制。 
µC/OS-II源代码主要组成：
	1. 系统核心
	2. 任务管理 
	3. 时钟管理 
	4. 任务同步和任务间通讯 
	5. 内存管理 
	6. 处理器相关代码

----
µC/OS-II任务及管理
+ 任务构成：µC/OS-II中，任务是操作系统的基本调度单位。 任务由三部分组成： 
	1. 程序代码：没有返回值的C函数， 
	2. 任务堆栈：用于保存任务的工作环境， 
	3. 任务控制块：保存任务状态和属性的数据结构

+ 任务的状态：µC/OS-II的任务处于5种状态：
	1. **休眠态**：任务代码驻留在内存中但还没有交给内核调度的状态，调用创建任务后
	2. **就绪态**：任务已经具备运行条件但因优先级比正在运行的任务低而暂时不能运行的状态
	3. **运行态**：任务已经获得处理器的使用权而正在运行的状态，任何时刻系统中只有一个任务处于运行状态。
	4. **等待态/挂起态**：正在运行的任务因为某一事件发生而将处理器的使用权让给其它任务将自己挂起的状态。
	5. **被中断态**：处理器执行中断服务程序而被暂停运行的任务状态。

+ 任务调度：µC/OS-II可以管理**64个任务**（2.82版本后可以管理255个任务）， 0是最高优先级别，最低优先级由OS_LOWEST_PRIO定义， 8个保留给系统，最高优先级的0-3和最低优先级的4个OS_LOWEST_PRIO-3至OS_LOWEST_PRIO，即用户任务最多56个， 任务优先级具有唯一性，所以优先级作为任务的标识。
**空闲任务**：idle task，必须使用空闲任务，并且是最低优先级。不能被挂起和删除。 
**统计任务**：可选的任务，统计当前处理器利用率。 
**调度方式：**
	1. **任务级调度**：内核通过调度OS_TASK_SW()进行任务级的任务切换，保存当前任务的上下文（程序计数器PC，通用寄存器和处理器的状态寄存器），并恢复新任务的上下文。 
	2. **中断级调度**：中断级通过调用OSIntExit()进行任务调度 
临界区代码：
1. 利用宏OS_ENTER_CRITICAL（）和OS_EXIT_CRITICAL（）实现关中断和开中断
2. 利用函数OSSchedlock（）和OSSchedUnlock（）给调度器上锁和解锁。
+ 中断处理：中断服务程序执行步骤如下：
	1. 保存全部CPU寄存器
	2. 调用OSIntEnter（）或OSIntNesting直接加1
	3. 执行用户中断服务程序代码
	4. 调用OSIntExit（）
	5. 回复所有CPU寄存器
	6. 执行中断返回指令
	通过OSIntNesting标识当前是否处于中断或中断嵌套的层数，中断嵌套**最多255层。 中断处理中不允许进行任务管理、事件管理、任务调度等**

µC/OS-II系统服务
+ 任务管理：
	+ **任务创建**：OSTaskCreate（）或者调用OSTaskCreateExt（）
任务可以在调用OSStart（）之前或者之后被创建。
在任务调度前必须至少创建一个用户任务。
	+ **任务删除**：OSTaskDel (INT8U prio)函数用于删除任务 prio
任务可以删除其他任务也可以删除自身，
删除后转入休眠态，不被内核调度
如有共享资源访问可以调用OSTaskDelReg（）函数让任务使用完资源后再删除。
	+ **任务挂起和恢复**：OSTaskSuspend（） 可以挂起任务。可以挂起自身可其他任务，必须调用OSTaskResume（）进行任务的恢复。
+ 时钟节拍和时间管理：操作系统内核需要周期性的信号源用于时间延时和超时。用户必须在调用OSStart（）启动多任务调度以后再开启时钟节拍器。在调用OSStart（）后的第一件事就是初始化定时器中断。 
任务延时：OSTimeDly()：延时时间是以节拍数来衡量的 
```
OSTimeDlyHMSM(CPU_INT16U   hours,
CPU_INT16U   minutes,
CPU_INT16U   seconds,
CPU_INT32U   milli,
OS_OPT       opt,
OS_ERR      *p_err)：延时时间则是以具体时间大小来衡量的               
*  hours        (0...99)
*  minutes      (0...59) 
*  seconds      (0...59)
*  milliseconds (0...999)
```

+ 任务间通讯和同步：任务间通讯常用的有： 
	1. **信号量**：    创建/删除/释放/等待/查询 
	2. 互斥信号量：创建/删除/释放/等待/查询 
	3. 事件标志组：创建/删除/释放/等待/查询 
	4. 消息邮箱：  创建/删除/释放/等待/查询 '
	5. 消息队列：  创建/删除/释放/等待/查询

----
µC/OS-II应用程序设计

+ **µC/OS初始化和main()函数结构**：基于µC/OS II 的多任务系统中，引导加载程序执行完毕则调用主函数main（）。
主函数主要实现的功能包括：
	1. 硬件初始化、
	2. 调用OSInit（）初始化µC/OS-II的内核，
	3. 创建任务、
	4. 创建任务间通讯或同步的内核对象、
	5. 应用程序相关的初始化、
	6. 调用OSStart（）启动多任务调度等。
+ **用户任务的三种结构**：任务可以是一个无限循环，也可以在任务完成后自我删除。
+ 通常任务有三种结构：
	1. **单次执行任务**：任务创建后处于就绪态并可以被执行，执行完相应的功能后则自我删除。 
	2. **周期执行任务**：任务通常采用循环结构，并在每次完成具体的功能后调用系统延时函数OSTimeDlyHMSM（）或者OSTimeDly（）等待下一个执行周期，并将处理器让给其它任务。 
	3. **事件触发执行的任务**：任务的实体代码只有在某种事件发生后才执行。在事件发生之前，任务被挂起。任务也采用循环结构，事件触发一次，任务执行一次。

----

**应用程序设计实例**
µC/OS-III操作系统的改进和提高

µC/OS-II定位于8位/16位/低端32位处理器
µC/OS-III定位于高端32位处理器，在8位/16位上也可以运行。

µC/OS-III增加的主要特性：
1. 时间片轮转调度：允许给任务相同的优先级                           
2. 内核对象的无限制：任务、信号量、互斥信号量、事件标志、消息队列、定时器等
3. 任务消息和任务信号：任务本身即可以发送消息和信号量
4. 时钟节拍：使用哈希散列表机制
5. 可针对处理器体系结构进行优化
6. 时间戳
7. 增强内置性能测试功能：测试任务、CPU的占用情况

## 第五章：嵌入式系统开发

## 5.1 开发嵌入式系统的基础知识

### 5.1.1嵌入式系统的开发过程：
+ 需求分析与规格说明
+ 系统设计
+ 构建设计
+ 系统集成和测试：测试（Test）的目的是验证模块/系统的功能和性能，发现错误。 
调试（Debug）的任务是分析测试中发现的错误，检查原因、定位故障位置，采取适当的措施，修改软件/硬件，然后返回重新进行测试。

### 5.1.2开发平台和工具
+ 嵌入式系统的开发特点：
宿主机-目标机的开发架构
嵌入式系统的开发平台多半不是最终的运行平台，因此嵌入式的开发通常需要构建一个宿主机-目标机的交叉编译及运行环境，用于编程、调试的计算机称为宿主机（Host），用于程序最终运行的称为目标机（Target）。与底层硬件控制程序的关系密切软硬件资源受限需要固化程序
+ 开发平台和开发工具：集成开发环境（IDE）
+ 典型开发平台
+ 
### 5.1.3嵌入式系统的调试

+ 在线仿真器（ICE）
+ 片上调试技术（OCD）-JTAG：JTAG(Joint Test Action Group,联合测试工作组)是一种国际标准测试协议（IEEE 1149.1兼容），主要用于芯片内部测试。 标准的JTAG接口4线：TMS、TCK、TDI、TDO，分别为模式选择、时钟、数据输入和数据输出线。 信号线TRST（复位）是可选的。
+ 驻留监控软件调试
+ 指令集模拟器（ARMulator和SkyEye）

## 5.2 系统开发工具软件
+ ADS1.2工具软件
+ RVDS
+ GNU：**GNU**是“GNU is Not Unix”的递归缩写，常用于基于Linux操作系统的嵌入式软件工具套件简称。包括编译器、连接器、文本剪辑器、语法除错等工具。
  + **GCC概述**：针对Linux操作系统环境下应用程序的编译工具，可以将C语言、C++语言、汇编语言编写的源程序及库文件编译连接成执行文件。 从源文件生成执行文件的过程为：**预处理、编译、汇编、连接**。 

    生成可执行文件时，无论工程目录中只有一个源文件还是多个源文件，所有被编译和连接的源文件中必须有且仅有一个main函数。 若仅仅是把源文件编译成目标文件，不进行连接操作，main函数就不是必须的。

  + **GCC命令和参数**：基本命令格式为：`gcc [options] [filenames]`
    options代表编译器命令所需要的参数
    filenames代表命令中所涉及的相关文件名称
    针对ARM系列微处理器为核心的目标机，**GCC的基本命令格式是**：`arm-linux-gcc [options] [filenames]`

  + **GDB**： GDB是GNU开发工具套件中的程序调试工具，可以提供单步执行和断点执行功能，并观察程序执行时变量值的变化。

  + **GNU的使用**：

    1. 需要建立好交叉编译环境，并在宿主机上安装应用于目标机硬件平台的GCC，GDB等工具软件。
    2. 采用一个文本编辑器来编辑项目中所需要的源文件，源文件可以是C/C++/汇编语言 
    3. 利用与目标机硬件平台相关的GCC命令完成预处理、编译、汇编、连接工作。项目中由若干个源文件组成时，通常编写Makefile文件来确定源文件的连接顺序、若程序中只有一个源文件，则不需要Makefile文件，直接使用GCC命令来完成编译工作。 
    4. 利用GDB工具进行程序调试。注意：在编译时需要在命令中加入-g参数，以便生成调试信息。

## 5.3 系统开发示例

+ 数字式电子钟
+ 便携式心电记录仪
+ 基于嵌入式Web服务器的应用设计
















